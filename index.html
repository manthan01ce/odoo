<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Dayflow HRMS</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
body{
  margin:0;
  font-family:Arial,sans-serif;
  background:linear-gradient(120deg,#1e3c72,#2a5298);
  min-height:100vh;
}
.container{
  width:380px;
  background:#fff;
  margin:40px auto;
  padding:25px;
  border-radius:10px;
  box-shadow:0 15px 30px rgba(0,0,0,0.3);
}
h2{text-align:center;color:#1e3c72}
input,select,button{
  width:100%;
  padding:10px;
  margin:8px 0;
  border-radius:5px;
  border:1px solid #ccc;
}
button{
  background:#1e3c72;
  color:#fff;
  border:none;
  cursor:pointer;
}
button:hover{background:#16315a}
.link{text-align:center;margin-top:10px}
.link a{color:#1e3c72;font-weight:bold;cursor:pointer}
.error{color:red;font-size:14px;text-align:center}
.success{color:green;font-size:14px;text-align:center}
.hidden{display:none}
/* DASHBOARD */
.dashboard{
  width:90%;
  max-width:900px;
  background:#fff;
  margin:30px auto;
  padding:20px;
  border-radius:10px;
}
.header{
  background:#1e3c72;
  color:#fff;
  padding:15px;
  text-align:center;
  border-radius:10px 10px 0 0;
}
.cards{
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(180px,1fr));
  gap:15px;
  margin-top:20px;
}
.card{
  background:#f4f6f9;
  padding:20px;
  border-radius:10px;
  text-align:center;
  box-shadow:0 5px 10px rgba(0,0,0,0.1);
  cursor:pointer;
}
.logout{
  text-align:center;
  margin-top:20px;
}
small{font-size:12px}
input[disabled]{background:#e0e0e0;}
#pPicDisplay{width:100px;height:100px;border-radius:50%;display:block;margin-top:10px;}
table{border-collapse:collapse;width:100%;margin-top:10px;}
table th, table td{border:1px solid #ccc;padding:8px;text-align:center;}
table th{background:#1e3c72;color:#fff;}
</style>
</head>
<body>

<div class="container" id="loginBox">
  <h2>Sign In</h2>
  <input type="email" id="loginEmail" placeholder="Email">
  <input type="password" id="loginPassword" placeholder="Password">
  <button onclick="login()">Login</button>
  <p class="error" id="loginError"></p>
  <p class="success" id="loginSuccess"></p>
  <div class="link">New user? <a onclick="showRegister()">Sign Up</a></div>
</div>

<div class="container hidden" id="registerBox">
  <h2>Sign Up</h2>
  <input id="empId" placeholder="Employee ID">
  <input type="email" id="regEmail" placeholder="Email">
  <input type="password" id="regPassword" placeholder="Password">
  <small>
    Password must contain:
    <br>‚Ä¢ Minimum 8 characters
    <br>‚Ä¢ One uppercase letter
    <br>‚Ä¢ One number
  </small>
  <select id="role">
    <option value="">Select Role</option>
    <option value="Employee">Employee</option>
    <option value="HR">HR</option>
  </select>
  <button onclick="sendOTP()">Verify Email</button>
  <div id="otpSection" class="hidden">
    <input id="otpInput" placeholder="Enter OTP">
    <button onclick="verifyOTP()">Complete Registration</button>
    <p class="success" id="otpMsg"></p>
  </div>
  <p class="error" id="regError"></p>
  <div class="link">Already registered? <a onclick="showLogin()">Sign In</a></div>
</div>

<div class="dashboard hidden" id="employeeDash">
  <div class="header">
    <h2>Employee Dashboard</h2>
    <p id="empInfo"></p>
  </div>
  <div class="cards">
    <div class="card" onclick="openProfile()">üë§ Profile</div>
    <div class="card" onclick="openAttendance()">üïí Attendance</div>
    <div class="card">üìù Leave Requests</div>
    <div class="card">üîî Alerts</div>
  </div>
  <p class="success">‚úî Attendance status is up to date.</p>
  <div class="logout">
    <button onclick="logout()">Logout</button>
  </div>
</div>

<div class="dashboard hidden" id="profilePage">
  <div class="header">
    <h2>Profile Management</h2>
    <p id="profileRole"></p>
  </div>
  <div class="container">
    <h3>Personal Details</h3>
    <input id="pName" placeholder="Full Name">
    <input id="pEmail" disabled>
    <input id="pPhone" placeholder="Phone Number">
    <input id="pAddress" placeholder="Address">
    <h3>Profile Picture</h3>
    <input type="file" id="pPicInput" accept="image/*">
    <img id="pPicDisplay" src="" alt="Profile Picture">
    <h3>Job Details</h3>
    <input id="pEmpId" disabled>
    <input id="pDept" placeholder="Department">
    <input id="pRole" placeholder="Job Role">
    <h3>Salary Structure</h3>
    <input id="pSalary" placeholder="Salary">
    <h3>Documents</h3>
    <input disabled value="Aadhar.pdf">
    <input disabled value="PAN.pdf">
    <div class="logout">
      <button id="saveProfileBtn">Save Changes</button>
      <button id="backBtn">Back to Dashboard</button>
    </div>
  </div>
</div>

<div class="dashboard hidden" id="attendancePage">
  <div class="header">
    <h2>Attendance</h2>
    <p id="attendanceInfo"></p>
  </div>
  <div class="container">
    <div id="attendanceActions">
        <button onclick="checkIn()">Check In</button>
        <button onclick="checkOut()">Check Out</button>
    </div>
    <div id="attendanceDisplay"></div>
    <div class="logout">
      <button id="attendanceBackBtn" onclick="backDashboard()">Back</button>
    </div>
  </div>
</div>

<div class="dashboard hidden" id="adminDash">
  <div class="header">
    <h2>Admin Dashboard (HR)</h2>
    <p id="adminInfo"></p>
  </div>
  <div class="cards">
    <div class="card" onclick="showEmployeeList()">üë• Employee List</div>
    <div class="card" onclick="openHRAttendance()">üïí Global Attendance</div>
    <div class="card">üìù Leave Approvals</div>
  </div>

  <div id="employeeListContainer" class="hidden">
    <hr>
    <h3>All Employees</h3>
    <table>
      <thead>
        <tr>
          <th>Emp ID</th>
          <th>Name</th>
          <th>Email</th>
          <th>Role</th>
          <th>Action</th>
        </tr>
      </thead>
      <tbody id="employeeListBody"></tbody>
    </table>
    <button onclick="hideEmployeeList()">Close List</button>
  </div>

  <div id="hrAttendanceContainer" class="hidden">
    <hr>
    <h3>All Attendance Records</h3>
    <div id="hrAttendanceDisplay"></div>
    <button onclick="hideHRAttendance()">Close Records</button>
  </div>

  <div class="logout">
    <button onclick="logout()">Logout</button>
  </div>
</div>

<script>
let generatedOTP = null;

/* ELEMENT SHORTCUTS */
const loginBox = document.getElementById("loginBox");
const registerBox = document.getElementById("registerBox");
const employeeDash = document.getElementById("employeeDash");
const profilePage = document.getElementById("profilePage");
const attendancePage = document.getElementById("attendancePage");
const adminDash = document.getElementById("adminDash");
const employeeListContainer = document.getElementById("employeeListContainer");
const hrAttendanceContainer = document.getElementById("hrAttendanceContainer");

/* NAVIGATION TOGGLES */
function showRegister(){ loginBox.classList.add("hidden"); registerBox.classList.remove("hidden"); }
function showLogin(){ registerBox.classList.add("hidden"); loginBox.classList.remove("hidden"); }

/* REGISTRATION */
function sendOTP(){
  if(!empId.value||!regEmail.value||!regPassword.value||!role.value){ regError.innerText="All fields are required"; return; }
  let regex=/^(?=.*[A-Z])(?=.*\d).{8,}$/;
  if(!regex.test(regPassword.value)){ regError.innerText="Password rules not met"; return; }
  generatedOTP=Math.floor(100000+Math.random()*900000);
  otpMsg.innerText="Demo OTP: "+generatedOTP;
  otpSection.classList.remove("hidden"); regError.innerText="";
}

function verifyOTP(){
  if(otpInput.value!=generatedOTP){ regError.innerText="Invalid OTP"; return; }
  let users=JSON.parse(localStorage.getItem("users"))||[];
  users.push({ empId:empId.value, email:regEmail.value, password:regPassword.value, role:role.value });
  localStorage.setItem("users",JSON.stringify(users));
  otpMsg.innerText="‚úÖ Registration completed successfully!";
  setTimeout(showLogin,2000);
}

/* LOGIN */
function login(){
  let users=JSON.parse(localStorage.getItem("users"))||[];
  let user=users.find(u=>u.email===loginEmail.value && u.password===loginPassword.value);
  if(!user){ loginError.innerText="‚ùå Invalid email or password"; return; }
  
  // Clean session
  localStorage.removeItem("currentUser");
  localStorage.removeItem("currentHR");

  if(user.role==="HR") {
      localStorage.setItem("currentHR", JSON.stringify(user));
      adminDash.classList.remove("hidden");
      adminInfo.innerText="Logged in as HR: "+user.email;
  } else {
      localStorage.setItem("currentUser", JSON.stringify(user));
      employeeDash.classList.remove("hidden");
      empInfo.innerText="Logged in as: "+user.email;
  }
  
  loginBox.classList.add("hidden");
  loginError.innerText="";
}

/* PROFILE SYSTEM */
function openProfile(){
  let user = JSON.parse(localStorage.getItem("currentUser"));
  loadProfile(user, "employee");
}

function viewEmployeeProfile(email){
  let targetUser = JSON.parse(localStorage.getItem("users")).find(u=>u.email===email);
  loadProfile(targetUser, "hr");
}

function loadProfile(targetUser, viewerType){
  // UI Switch
  employeeDash.classList.add("hidden");
  adminDash.classList.add("hidden");
  profilePage.classList.remove("hidden");

  let profileData = JSON.parse(localStorage.getItem(targetUser.email)) || 
    {name:"", phone:"", address:"", dept:"IT", jobRole:targetUser.role, salary:"‚Çπ30,000", picture:""};

  // Populate Fields
  pName.value = profileData.name || "";
  pEmail.value = targetUser.email;
  pPhone.value = profileData.phone || "";
  pAddress.value = profileData.address || "";
  pEmpId.value = targetUser.empId;
  pDept.value = profileData.dept;
  pRole.value = profileData.jobRole;
  pSalary.value = profileData.salary;
  pPicDisplay.src = profileData.picture || "";

  // Logic: Only HR can edit professional details
  const isHR = (viewerType === "hr");
  pDept.disabled = !isHR;
  pRole.disabled = !isHR;
  pSalary.disabled = !isHR;
  profileRole.innerText = isHR ? "Access: HR Mode (Editing Employee)" : "Access: Employee Mode";

  saveProfileBtn.onclick = function(){
    let updatedProfile = {
        name: pName.value,
        phone: pPhone.value,
        address: pAddress.value,
        dept: pDept.value,
        jobRole: pRole.value,
        salary: pSalary.value,
        picture: pPicDisplay.src
    };
    
    let file = pPicInput.files[0];
    if(file){
      let reader = new FileReader();
      reader.onload = function(e){ 
          updatedProfile.picture = e.target.result; 
          localStorage.setItem(targetUser.email, JSON.stringify(updatedProfile));
          pPicDisplay.src = updatedProfile.picture;
          alert("Profile Updated!"); 
      }
      reader.readAsDataURL(file);
    } else {
      localStorage.setItem(targetUser.email, JSON.stringify(updatedProfile));
      alert("Profile Updated!");
    }
  };

  backBtn.onclick = function(){
    profilePage.classList.add("hidden");
    if(isHR) {
        adminDash.classList.remove("hidden");
        showEmployeeList(); // Keep the list open
    } else {
        employeeDash.classList.remove("hidden");
    }
  };
}

/* HR EMPLOYEE LIST */
function showEmployeeList(){
  let users = JSON.parse(localStorage.getItem("users"))||[];
  let tbody = document.getElementById("employeeListBody");
  tbody.innerHTML = "";
  users.forEach(user => {
    if(user.role === "Employee"){
      let prof = JSON.parse(localStorage.getItem(user.email)) || {};
      let tr = document.createElement("tr");
      tr.innerHTML = `
        <td>${user.empId}</td>
        <td>${prof.name || '---'}</td>
        <td>${user.email}</td>
        <td>${prof.jobRole || user.role}</td>
        <td>
          <button onclick="viewEmployeeProfile('${user.email}')">Edit</button>
          <button onclick="viewEmployeeAttendance('${user.email}')">Logs</button>
        </td>`;
      tbody.appendChild(tr);
    }
  });
  employeeListContainer.classList.remove("hidden");
  hrAttendanceContainer.classList.add("hidden");
}

function hideEmployeeList(){ employeeListContainer.classList.add("hidden"); }

/* ATTENDANCE SYSTEM */
function openAttendance(){
  employeeDash.classList.add("hidden");
  attendancePage.classList.remove("hidden");
  document.getElementById("attendanceActions").classList.remove("hidden");
  let user = JSON.parse(localStorage.getItem("currentUser"));
  attendanceInfo.innerText = "My Attendance: " + user.email;
  showAttendance(user.email, "attendanceDisplay");
}

function viewEmployeeAttendance(email){
  adminDash.classList.add("hidden");
  attendancePage.classList.remove("hidden");
  document.getElementById("attendanceActions").classList.add("hidden"); // HR shouldn't Check-In for others
  attendanceInfo.innerText = "Viewing Logs: " + email;
  showAttendance(email, "attendanceDisplay");
  
  // Custom back for HR
  document.getElementById("attendanceBackBtn").onclick = function(){
      attendancePage.classList.add("hidden");
      adminDash.classList.remove("hidden");
  };
}

function checkIn(){
  let user = JSON.parse(localStorage.getItem("currentUser"));
  let today = new Date().toISOString().slice(0,10);
  let att = JSON.parse(localStorage.getItem("attendance"))||{};
  if(!att[user.email]) att[user.email]={};
  if(att[user.email][today]) { alert("Already recorded for today"); return; }
  
  att[user.email][today] = {checkIn: new Date().toLocaleTimeString(), checkOut:null, status:"Absent"};
  localStorage.setItem("attendance", JSON.stringify(att));
  showAttendance(user.email, "attendanceDisplay");
}

function checkOut(){
  let user = JSON.parse(localStorage.getItem("currentUser"));
  let today = new Date().toISOString().slice(0,10);
  let att = JSON.parse(localStorage.getItem("attendance"))||{};
  if(!att[user.email] || !att[user.email][today] || att[user.email][today].checkOut) { alert("Invalid Action"); return; }
  
  att[user.email][today].checkOut = new Date().toLocaleTimeString();
  att[user.email][today].status = "Full Day";
  localStorage.setItem("attendance", JSON.stringify(att));
  showAttendance(user.email, "attendanceDisplay");
}

function showAttendance(email, divId){
  let att = JSON.parse(localStorage.getItem("attendance"))||{};
  let data = att[email] || {};
  let html = "<table><tr><th>Date</th><th>In</th><th>Out</th><th>Status</th></tr>";
  for(let date in data){
    html += `<tr><td>${date}</td><td>${data[date].checkIn}</td><td>${data[date].checkOut||'--'}</td><td>${data[date].status}</td></tr>`;
  }
  html += "</table>";
  document.getElementById(divId).innerHTML = html;
}

/* HR GLOBAL VIEWS */
function openHRAttendance(){
  hrAttendanceContainer.classList.remove("hidden");
  employeeListContainer.classList.add("hidden");
  let attendance = JSON.parse(localStorage.getItem("attendance"))||{};
  let html = "<table><tr><th>User</th><th>Date</th><th>In</th><th>Out</th><th>Status</th></tr>";
  for(let email in attendance){
    for(let date in attendance[email]){
      let row = attendance[email][date];
      html += `<tr><td>${email}</td><td>${date}</td><td>${row.checkIn}</td><td>${row.checkOut||'--'}</td><td>${row.status}</td></tr>`;
    }
  }
  html += "</table>";
  document.getElementById("hrAttendanceDisplay").innerHTML = html;
}

function hideHRAttendance(){ hrAttendanceContainer.classList.add("hidden"); }

/* GLOBAL HELPERS */
function backDashboard(){
  attendancePage.classList.add("hidden");
  profilePage.classList.add("hidden");
  if(localStorage.getItem("currentHR")) adminDash.classList.remove("hidden");
  else employeeDash.classList.remove("hidden");
}

function logout(){
  localStorage.removeItem("currentUser");
  localStorage.removeItem("currentHR");
  location.reload();
}
</script>
</body>
</html>